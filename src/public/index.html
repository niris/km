<!DOCTYPE html>
<html lang=th>
<meta charset="utf-8">
<title>RERU Knowlege Management</title>
<meta name=viewport content="width=device-width,initial-scale=1.0">
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<link rel=stylesheet href="https://cdnjs.cloudflare.com/ajax/libs/marx/3.0.3/marx.min.css">
<link rel=stylesheet href="/public/css/home.css">
<link rel=stylesheet href="/public/css/user.css">
<link rel=stylesheet href="/public/css/style.css">
<link rel=stylesheet href="/public/css/navbar.css">
<link rel=stylesheet href="/public/css/graph.css">
<script src="http://d3js.org/d3.v5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.4.0/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.4.1/jspdf.min.js"></script>

<div id=app>
	<nav-bar></nav-bar>
	<main>
		<router-view />
	</main>
	<Toaster />
</div>

<script src="https://unpkg.com/vue@2"></script>
<script src="https://unpkg.com/vue-router@3"></script>
<script type=module>
Vue.mixin({
  methods: {
    sfetch(form, query="") {
      var params = { headers: { authorization: localStorage.token }, method: ((form.attributes||{}).method||{}).value || 'GET', query};
      if (form instanceof HTMLFormElement) {
        if (params.method.match(/^POST$/i)) params.body = new FormData(form);
        else params.query = '?' + new URLSearchParams(new FormData(form));
        params.path = new URL(form.action).pathname;
      } else {
        params.path = form;
        params.query = '?'+Object.keys(params.query).map(k => encodeURIComponent(k) + '=' + encodeURIComponent(params.query[k])).join('&');
      }
      return fetch(params.path+params.query, params).then(r => {
        if (!r.ok) throw Error(r.statusText);
        if (r.headers.has('authorization')) {
          this.$root.token = r.headers.get('authorization');
        }
        return r;
      })
    }
  }
})

import NavBar from "./public/components/NavBar.js";
import Toaster from "./public/components/Toaster.js";
import Home from './public/components/Home.js'
import Activity from './public/components/Activity.js'
import User from './public/components/User.js'

new Vue({
  el: '#app',
	components: { NavBar, Toaster },
  data: function () {
    return {
      get token() { return localStorage.getItem('token') || ''; },
      set token(v) { localStorage.setItem('token', v) },
      get me() { return (localStorage.getItem('token') || '').split(' ')[0]; },
    };
  },

  router: new VueRouter({
    mode: 'history',
    routes: [
      { path: '/', name: "Home", component: Home },
      { path: '/activity/:id?', name: "Activity", component: Activity, props: true },
      { path: '/user/:id?', name: "User", component: User, props: true },
    ]
  }),
})
</script>